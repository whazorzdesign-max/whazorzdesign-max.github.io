<!DOCTYPE html>
<html>
<head>
    <title>WoW Character Lookup</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; text-align: center; padding: 50px; }
        .container { background: #1e1e1e; padding: 20px; border-radius: 10px; display: inline-block; }
        input { padding: 10px; border-radius: 5px; border: 1px solid #444; background: #000; color: white; }
        button { padding: 10px 20px; background: #ffd100; border: none; font-weight: bold; cursor: pointer; }
        #result { margin-top: 20px; }
        .render-img { width: 100%; max-width: 500px; filter: drop-shadow(0 0 10px #000); }
    </style>
</head>
<body>

    <div class="container">
        <input type="text" id="realm" placeholder="Realm (e.g. Stormscale)">
        <input type="text" id="name" placeholder="Character Name">
        <button onclick="fetchCharacter()">Search</button>
        
        <div id="result"></div>
    </div>

    <script>
        // Use 'async' here so 'await' works inside
        async function fetchCharacter() {
            const name = document.getElementById('name').value.trim();
            const realm = document.getElementById('realm').value.trim();
            const resultDiv = document.getElementById('result');

            if (!name || !realm) {
                alert("Please enter name and realm");
                return;
            }

            resultDiv.innerHTML = "Fetching character...";

            try {
                // Change this URL to your actual worker URL
                const workerUrl = `https://my-worker.whazorz.workers.dev/?name=${encodeURIComponent(name)}&realm=${encodeURIComponent(realm)}`;
                
                const response = await fetch(workerUrl);
                const data = await response.json();

                if (data.error || !data.profile) {
                    resultDiv.innerHTML = "Character not found or API error.";
                    return;
                }

                // Find the 3D Render (main-raw is the best quality)
                const assets = data.media.assets || [];
                const renderUrl = assets.find(a => a.key === 'main-raw')?.value 
                               || assets.find(a => a.key === 'main')?.value 
                               || assets.find(a => a.key === 'avatar')?.value;

                resultDiv.innerHTML = `
                    <h2>${data.profile.name}</h2>
                    <p>${data.profile.character_class.name} - ${data.profile.active_spec.name}</p>
                    <img src="${renderUrl}" class="render-img" alt="Character Render">
                    <p>Level: ${data.profile.level} | iLvl: ${data.profile.average_item_level}</p>
                `;

            } catch (err) {
                console.error(err);
                resultDiv.innerHTML = "Failed to connect to Worker.";
            }
        }
    </script>
</body>
</html>