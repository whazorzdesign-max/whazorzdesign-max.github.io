<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #111; color: white; font-family: sans-serif; }
        
        /* 16:9 Viewport in the Middle */
        #viewport-container {
            position: relative;
            width: 100vw;
            height: 56.25vw; /* 16:9 Ratio */
            max-height: 100vh;
            max-width: 177.78vh;
            margin: auto;
            background: #222;
            border: 2px solid #444;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Interface Overlay (Modeling Software Style) */
        .ui-panel {
            position: absolute;
            background: rgba(30, 30, 30, 0.9);
            padding: 15px;
            border: 1px solid #555;
            font-size: 12px;
            z-index: 10;
        }
        .left-panel { top: 10px; left: 10px; width: 200px; bottom: 10px; }
        .right-panel { top: 10px; right: 10px; width: 220px; bottom: 10px; }
        .bottom-bar { bottom: 10px; left: 220px; right: 230px; height: 40px; text-align: center; }

        canvas { width: 100%; height: 100%; display: block; }
        
        button { background: #444; color: white; border: 1px solid #666; padding: 5px; cursor: pointer; margin: 2px; }
        button:hover { background: #ffd100; color: black; }
    </style>
</head>
<body>

    <div id="viewport-container">
        <div id="three-canvas-container"></div>

        <div class="ui-panel left-panel">
            <h3>Scene Explorer</h3>
            <div id="character-info">Character: None</div>
            <hr>
            <h4>Bones</h4>
            <label><input type="checkbox" id="show-bones" onchange="toggleBones()"> Show Skeleton</label>
            <div id="bone-list"></div>
        </div>

        <div class="ui-panel right-panel">
            <h3>Animations</h3>
            <button onclick="playAnim('Idle')">Idle</button>
            <button onclick="playAnim('Attack')">Attack</button>
            <button onclick="playAnim('Dance')">Dance</button>
            <hr>
            <h4>Pose Controls</h4>
            <button onclick="randomPose()">Random Bone Pose</button>
            <hr>
            <button onclick="takeScreenshot()" style="width:100%; background:#28a745;">Download Alpha PNG</button>
        </div>

        <div class="ui-panel bottom-bar">
            Timeline: [------------------|------------------]
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FBXLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/libs/fflate.min.js"></script>

    <script>
        let scene, camera, renderer, model, skeletonHelper, mixer;

        function init3D() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, 16/9, 0.1, 1000);
            camera.position.set(0, 150, 400);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerWidth * (9/16)); // Maintain 16:9
            renderer.setClearColor(0x000000, 0); // Transparent background for Alpha Screenshot
            document.getElementById('three-canvas-container').appendChild(renderer.domElement);

            const light = new THREE.HemisphereLight(0xffffff, 0x444444);
            scene.add(light);

            animate();
        }

        function loadModel(url) {
            const loader = new THREE.FBXLoader();
            loader.load(url, (fbx) => {
                model = fbx;
                model.scale.set(0.5, 0.5, 0.5);
                scene.add(model);

                // Add Skeleton Helper
                skeletonHelper = new THREE.SkeletonHelper(model);
                skeletonHelper.visible = false;
                scene.add(skeletonHelper);
                
                // Set up Animations
                mixer = new THREE.AnimationMixer(model);
            });
        }

        function toggleBones() {
            if (skeletonHelper) skeletonHelper.visible = document.getElementById('show-bones').checked;
        }

        function takeScreenshot() {
            // Render one frame with alpha
            renderer.render(scene, camera);
            const dataURL = renderer.domElement.toDataURL("image/png");
            const link = document.createElement('a');
            link.download = 'character-alpha.png';
            link.href = dataURL;
            link.click();
        }

        function animate() {
            requestAnimationFrame(animate);
            if (mixer) mixer.update(0.016);
            renderer.render(scene, camera);
        }

        init3D();
    </script>
</body>
</html>