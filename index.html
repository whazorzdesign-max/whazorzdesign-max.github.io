<div class="container">
    <select id="region">
        <option value="eu">Europe (EU)</option>
        <option value="us">Americas (US)</option>
        <option value="kr">Korea (KR)</option>
        <option value="tw">Taiwan (TW)</option>
    </select>
    <input type="text" id="realm" placeholder="Realm (e.g. Area 52)">
    <input type="text" id="name" placeholder="Character Name">
    <button onclick="fetchCharacter()">Search</button>
    
    <div id="result"></div>
</div>

<script>
async function fetchCharacter() {
    const region = document.getElementById('region').value;
    const name = document.getElementById('name').value.trim();
    const realm = document.getElementById('realm').value.trim();
    const resultDiv = document.getElementById('result');

    if (!name || !realm) return alert("Enter details");

    resultDiv.innerHTML = "Searching " + region.toUpperCase() + "...";

    try {
        // Updated URL to include the region parameter
        const workerUrl = `https://my-worker.whazorz.workers.dev/?name=${encodeURIComponent(name)}&realm=${encodeURIComponent(realm)}&region=${region}`;
        
        const response = await fetch(workerUrl);
        const data = await response.json();

        if (data.error || !data.profile.name) {
            resultDiv.innerHTML = "Character not found on " + region.toUpperCase();
            return;
        }

        const assets = data.media.assets || [];
        const renderUrl = assets.find(a => a.key === 'main-raw')?.value || assets.find(a => a.key === 'main')?.value;

        let rosterHtml = "";
        if (data.roster && data.roster.length > 0) {
            rosterHtml = `<h4>Guild: ${data.profile.guild.name}</h4><div style="max-height:150px; overflow-y:auto; font-size:12px; border:1px solid #333;">`;
            data.roster.slice(0, 30).forEach(m => {
                rosterHtml += `<div>${m.character.name} - Rank ${m.rank}</div>`;
            });
            rosterHtml += `</div>`;
        }

        resultDiv.innerHTML = `
            <h3>${data.profile.name} (${data.region.toUpperCase()})</h3>
            <img src="${renderUrl}" style="width:100%; max-width:350px;">
            <p>${data.profile.character_class.name} | iLvl ${data.profile.average_item_level}</p>
            ${rosterHtml}
        `;

    } catch (err) {
        resultDiv.innerHTML = "Error connecting to worker.";
    }
}
</script>